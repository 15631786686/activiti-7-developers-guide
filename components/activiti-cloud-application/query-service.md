# Activiti Cloud Query Service

The Query Service enable client applications to get Process & Task data without going straight to the Runtime Bundles. The Query Service was designed to enable efficient querying mechanisms for data generated by one or more Runtime Bundles. In contrast with the Audit Service, the Query Service picks up the event and apply some transformations to store state.

This component was designed to aggregate data from a set of related Runtime Bundles, allowing consumers to filter using the runtime bundle.

![](../../.gitbook/assets/queryservice.png)

## Specification

## Endpoints

The query component provides read only REST endpoints.

## Event Listeners

The query service listen to events generated by runtime bundles and transform them to store state about the current process instances and tasks executions. This state is stored in a schema that is optimized for querying and based on the specification of this component different implementations using different technologies can be implemented.

Our reference implementation uses JPA entities to store this state and we defined a simple schema to store 3 entities:

* [ProcessInstance](https://github.com/Activiti/Activiti/blob/master/activiti-services/activiti-services-query/activiti-services-query-model/src/main/java/org/activiti/services/query/model/ProcessInstance.java)
* [Task](https://github.com/Activiti/Activiti/blob/master/activiti-services/activiti-services-query/activiti-services-query-model/src/main/java/org/activiti/services/query/model/Task.java)
* [Variable](https://github.com/Activiti/Activiti/blob/master/activiti-services/activiti-services-query/activiti-services-query-model/src/main/java/org/activiti/services/query/model/Variable.java)

## Security and Permissions

By default only admin users can access everything. The endpoints that under /admin/ can be accessed ACTIVITI\_ADMIN roles.

Process instance, task and variable data can be restricted to particular users or groups. This can be done by adding properties such as:

```text
activiti.cloud.security.user.testuser.rb-app-name.policy.read=defKey1 activiti.cloud.security.user.hruser.rb-app-name.policy.read=defKey2
```

Here rb-app-name is the name of a runtime bundle application. Or environment variables can be used such as

`ACTIVITI_CLOUD_SECURITY_USER_HRUSER_RBMYAPP_POLICY_READ=SimpleProcess` `ACTIVITI_CLOUD_SECURITY_GROUP_HR_RBMYAPP_POLICY_WRITE=SimpleProcess` `ACTIVITI_CLOUD_SECURITY_GROUP_TESTGROUP_RBMYAPP_POLICY_WRITE=*`

## Implementations

* [Activiti Cloud Query Service - JPA \(Reference \)using Spring Data JPA](https://github.com/Activiti/activiti-cloud-query/)
* [Activiti Cloud Query Service - ElasticSearch](https://) PR Under Review

## Docker Images

* [Activiti Cloud Query Service -&gt; JPA \(Reference\) Docker Image](https://hub.docker.com/r/activiti/activiti-cloud-query/)

